#!/usr/bin/env bash
# only run for interactive shells
[[ -z "$PS1" ]] && return

echo
echo "Welcome to {{ ansible_fqdn | default(ansible_hostname) }}!"
echo "Date: $(date '+%Y-%m-%d %H:%M:%S %Z')"
echo
# Load averages
read one five fifteen _ < /proc/loadavg
printf  "Load average:   %5.2f (1m)  %5.2f (5m)  %5.2f (15m)\n" \
        "$one" "$five" "$fifteen"
# Logged in users
users=$(who | wc -l)
printf "Users logged in: %d\n" "$users"
# Uptime in pretty form
printf "Uptime:         %s\n" "$(uptime -p)"
# Memory usage
mem_used=$(free -m | awk '/^Mem:/ {printf "%d/%dMB (%.0f%%)", $3, $2, $3/$2*100}')
printf "Memory used:    %s\n" "$mem_used"
# Root filesystem usage
root_pct=$(df -h / | awk 'END{print $5}')
printf "Disk / usage:   %s\n" "$root_pct"
echo